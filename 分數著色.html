<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†æ•¸åœ–å½¢è‘—è‰²ç”¢ç”Ÿå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
        }

        /* åˆ†æ•¸çš„ç›´å¼å¯«æ³• CSS */
        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1;
        }
        .fraction .numerator {
            display: block;
            border-bottom: 2px solid black;
            padding-bottom: 1px;
        }
        .fraction .denominator {
            display: block;
            padding-top: 1px;
        }

        /* æ ¼ç·šèˆ‡åœ–è¡¨æ¨£å¼ */
        .worksheet-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* é è¨­ä¸‰æ¬„ */
            gap: 2rem;
            width: 100%;
        }

        .question-card {
            border: 2px solid #e5e7eb;
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            page-break-inside: avoid; /* é¿å…åˆ—å°æ™‚è¢«åˆ‡æ–· */
        }

        svg {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
        }

        /* åˆ—å°å°ˆç”¨æ¨£å¼ */
        @media print {
            @page {
                size: A4;
                margin: 1cm;
            }
            body {
                background-color: white;
            }
            .no-print {
                display: none !important;
            }
            .worksheet-container {
                box-shadow: none !important;
                padding: 0 !important;
                margin: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            .question-card {
                border: 1px solid #ccc; /* åˆ—å°æ™‚é‚Šæ¡†ç´°ä¸€é» */
                box-shadow: none;
            }
            /* å¼·åˆ¶åˆ—å°èƒŒæ™¯åœ–å½¢é¡è‰²ï¼ˆé›–ç„¶æˆ‘å€‘æ˜¯é»‘ç™½çš„ï¼Œä½†ä»¥é˜²è¬ä¸€ï¼‰ */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
    </style>
</head>
<body class="p-8">

    <!-- æ§åˆ¶é¢æ¿ (åˆ—å°æ™‚éš±è—) -->
    <div class="no-print max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md mb-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-4">ğŸ¨ åˆ†æ•¸åœ–å½¢è‘—è‰²å­¸ç¿’å–®ç”¢ç”Ÿå™¨</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label class="block text-gray-700 font-bold mb-2">æ¨™é¡Œåç¨±ï¼š</label>
                <input type="text" id="sheetTitleInput" value="åˆ†æ•¸å¡—è‰²ç·´ç¿’" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div>
                <label class="block text-gray-700 font-bold mb-2">é¡Œç›®æ•¸é‡ (5-20)ï¼š</label>
                <input type="number" id="qCount" min="5" max="20" value="12" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none">
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-2">åœ–å½¢é¡å‹ï¼š</label>
                <select id="chartType" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none">
                    <option value="mixed">æ··åˆ (åœ“é¤…åœ– + é•·æ¢åœ–)</option>
                    <option value="pie">åªç”Ÿæˆåœ“é¤…åœ–</option>
                    <option value="bar">åªç”Ÿæˆé•·æ¢åœ–</option>
                </select>
            </div>

            <div class="flex items-end">
                <button onclick="generateWorksheet()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded mr-2 transition">
                    é‡æ–°ç”Ÿæˆé¡Œç›®
                </button>
                <button onclick="handlePrint()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded transition flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                    </svg>
                    åˆ—å° / å­˜æˆ PDF
                </button>
            </div>
        </div>
        <p class="text-sm text-gray-500 mt-4">æç¤ºï¼šé»æ“Šã€Œåˆ—å°ã€å¾Œï¼Œåœ¨å°è¡¨æ©Ÿé¸é …ä¸­é¸æ“‡ã€Œå¦å­˜ç‚º PDFã€å³å¯å„²å­˜æª”æ¡ˆã€‚</p>
    </div>

    <!-- å­¸ç¿’å–®é è¦½å€åŸŸ -->
    <div id="worksheetArea" class="worksheet-container max-w-4xl mx-auto bg-white p-8 shadow-lg min-h-screen">
        
        <!-- å­¸ç¿’å–®é ­éƒ¨ -->
        <div class="flex justify-between items-end border-b-2 border-black pb-4 mb-6">
            <div>
                <h1 id="displayTitle" class="text-3xl font-bold text-black">åˆ†æ•¸å¡—è‰²ç·´ç¿’</h1>
            </div>
            <div class="text-right flex gap-8">
                <div class="text-lg">ç­ç´šï¼š__________</div>
                <div class="text-lg">å§“åï¼š__________</div>
                <div class="text-lg">æ—¥æœŸï¼š__________</div>
            </div>
        </div>

        <!-- é¡Œç›®ç”Ÿæˆå€ -->
        <div id="questionsGrid" class="worksheet-grid">
            <!-- é¡Œç›®å°‡æœƒæ’å…¥åˆ°é€™è£¡ -->
        </div>

    </div>

    <script>
        // åˆå§‹åŒ–
        window.onload = generateWorksheet;

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // SVG åœ“é¤…åœ–ç”Ÿæˆå™¨
        function createPieChartSVG(denominator) {
            const size = 150;
            const cx = size / 2;
            const cy = size / 2;
            const r = (size / 2) - 5; // ç•™é‚Šè·
            
            let lines = "";
            for (let i = 0; i < denominator; i++) {
                // æ¯å€‹åˆ‡ç‰‡çš„è§’åº¦ (å¼§åº¦)
                // å¾ -90åº¦ (12é»é˜æ–¹å‘) é–‹å§‹
                const angle = (i * 2 * Math.PI / denominator) - (Math.PI / 2);
                const x = cx + r * Math.cos(angle);
                const y = cy + r * Math.sin(angle);
                lines += `<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="black" stroke-width="2" />`;
            }

            return `
                <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                    <!-- å¤–åœˆ -->
                    <circle cx="${cx}" cy="${cy}" r="${r}" stroke="black" stroke-width="2" fill="none" />
                    <!-- åˆ†éš”ç·š -->
                    ${lines}
                </svg>
            `;
        }

        // SVG é•·æ¢åœ–ç”Ÿæˆå™¨
        function createBarChartSVG(denominator) {
            const width = 200;
            const height = 50;
            const step = width / denominator;
            
            let lines = "";
            for (let i = 1; i < denominator; i++) {
                const x = i * step;
                lines += `<line x1="${x}" y1="0" x2="${x}" y2="${height}" stroke="black" stroke-width="2" />`;
            }

            return `
                <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
                    <!-- å¤–æ¡† -->
                    <rect x="1" y="1" width="${width-2}" height="${height-2}" stroke="black" stroke-width="2" fill="none" />
                    <!-- åˆ†éš”ç·š -->
                    ${lines}
                </svg>
            `;
        }

        // æ–°å¢åˆ—å°è™•ç†å‡½æ•¸ï¼Œç¢ºä¿å…ˆå–å¾—ç„¦é»
        function handlePrint() {
            window.focus(); // é‡è¦ï¼šç¢ºä¿è¦–çª—æ˜¯æ´»å‹•çš„
            setTimeout(() => {
                window.print();
            }, 100); // ç¨å¾®å»¶é²ä»¥ç¢ºä¿ç„¦é»åˆ‡æ›å®Œæˆ
        }

        function generateWorksheet() {
            const grid = document.getElementById('questionsGrid');
            grid.innerHTML = ''; // æ¸…ç©ºèˆŠé¡Œç›®

            // å–å¾—è¨­å®šå€¼
            const titleInput = document.getElementById('sheetTitleInput').value;
            document.getElementById('displayTitle').innerText = titleInput;

            let count = parseInt(document.getElementById('qCount').value);
            if (count < 5) count = 5;
            if (count > 20) count = 20;

            const chartType = document.getElementById('chartType').value;

            for (let i = 1; i <= count; i++) {
                // éš¨æ©Ÿç”Ÿæˆåˆ†æ¯ (3-15ï¼Œ2å¤ªç°¡å–®ä½†ä¹Ÿå¯ä»¥åŒ…å«ï¼Œé€™è£¡è¨­2-15)
                const denominator = getRandomInt(2, 15);
                // éš¨æ©Ÿç”Ÿæˆåˆ†å­ (1 åˆ° åˆ†æ¯-1ï¼Œé¿å…å…¨æ»¿)
                const numerator = getRandomInt(1, denominator);

                // æ±ºå®šé¡å‹
                let type = 'pie';
                if (chartType === 'bar') type = 'bar';
                else if (chartType === 'mixed') {
                    type = Math.random() > 0.5 ? 'pie' : 'bar';
                }

                let svgHtml = '';
                if (type === 'pie') {
                    svgHtml = createPieChartSVG(denominator);
                } else {
                    svgHtml = createBarChartSVG(denominator);
                }

                // å»ºç«‹å¡ç‰‡ HTML
                const card = document.createElement('div');
                card.className = 'question-card';
                card.innerHTML = `
                    <div class="mb-4 text-lg font-bold">ç¬¬ ${i} é¡Œ</div>
                    <div class="mb-4">
                        ${svgHtml}
                    </div>
                    <div class="text-xl flex items-center gap-2">
                        <span>è«‹å¡—ä¸Šï¼š</span>
                        <div class="fraction">
                            <span class="numerator">${numerator}</span>
                            <span class="denominator">${denominator}</span>
                        </div>
                    </div>
                `;

                grid.appendChild(card);
            }
        }
    </script>
</body>
</html>
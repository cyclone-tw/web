<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è‹±èªåå°„åŠ› â€” A1 åˆ° C1 å­¸ç¿’è·¯å¾‘</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0f;
  --surface: #12121a;
  --surface2: #1a1a26;
  --border: #2a2a3a;
  --text: #e8e6f0;
  --text-dim: #8a87a0;
  --accent: #ff6b35;
  --accent2: #ffd166;
  --a1: #4ecdc4;
  --a2: #45b7d1;
  --b1: #6c5ce7;
  --b2: #a855f7;
  --c1: #f472b6;
  --c2: #ff6b35;
  --success: #22c55e;
  --error: #ef4444;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'DM Sans', 'Noto Sans TC', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* Nav */
.nav {
  position: fixed; top: 0; left: 0; right: 0;
  z-index: 100;
  background: rgba(10,10,15,0.85);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 0 24px;
  height: 60px;
  display: flex; align-items: center; justify-content: space-between;
}
.nav-logo {
  font-family: 'Space Mono', monospace;
  font-weight: 700; font-size: 18px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.nav-tabs {
  display: flex; gap: 4px;
}
.nav-tab {
  padding: 8px 16px; border-radius: 8px;
  font-size: 13px; font-weight: 500;
  cursor: pointer; transition: all 0.2s;
  background: transparent; border: none; color: var(--text-dim);
}
.nav-tab:hover { color: var(--text); background: var(--surface2); }
.nav-tab.active { color: var(--accent); background: rgba(255,107,53,0.1); }

/* Main */
main { padding-top: 60px; }

.section { display: none; }
.section.active { display: block; }

/* Hero */
.hero {
  padding: 80px 24px 60px;
  text-align: center;
  position: relative;
  overflow: hidden;
}
.hero::before {
  content: '';
  position: absolute; top: -50%; left: -50%;
  width: 200%; height: 200%;
  background: radial-gradient(circle at 50% 50%, rgba(255,107,53,0.06) 0%, transparent 50%);
  animation: pulse 8s ease-in-out infinite;
}
@keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }
.hero h1 {
  font-family: 'Noto Sans TC', sans-serif;
  font-weight: 900; font-size: clamp(32px, 5vw, 56px);
  line-height: 1.2; margin-bottom: 16px;
  position: relative;
}
.hero h1 span {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.hero p { color: var(--text-dim); font-size: 18px; max-width: 600px; margin: 0 auto 32px; position: relative; }

/* Level Cards */
.level-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 12px; max-width: 800px; margin: 0 auto; padding: 0 24px;
  position: relative;
}
.level-card {
  padding: 20px 16px; border-radius: 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  cursor: pointer; transition: all 0.3s;
  text-align: center;
}
.level-card:hover { transform: translateY(-4px); border-color: var(--accent); }
.level-card .badge {
  display: inline-block; padding: 4px 12px; border-radius: 20px;
  font-family: 'Space Mono', monospace;
  font-weight: 700; font-size: 14px; margin-bottom: 8px;
}
.level-card[data-level="a1"] .badge { background: rgba(78,205,196,0.15); color: var(--a1); }
.level-card[data-level="a2"] .badge { background: rgba(69,183,209,0.15); color: var(--a2); }
.level-card[data-level="b1"] .badge { background: rgba(108,92,231,0.15); color: var(--b1); }
.level-card[data-level="b2"] .badge { background: rgba(168,85,247,0.15); color: var(--b2); }
.level-card[data-level="c1"] .badge { background: rgba(244,114,182,0.15); color: var(--c1); }
.level-card[data-level="c2"] .badge { background: rgba(255,107,53,0.15); color: var(--c2); }
.level-card .title { font-weight: 700; font-size: 15px; margin-bottom: 4px; }
.level-card .sub { font-size: 12px; color: var(--text-dim); }

/* Content Area */
.content-area {
  max-width: 900px; margin: 0 auto; padding: 40px 24px;
}

/* Module */
.module {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 32px;
  margin-bottom: 24px;
  animation: fadeIn 0.4s ease;
}
@keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
.module-header {
  display: flex; align-items: center; gap: 12px;
  margin-bottom: 20px;
}
.module-icon {
  width: 44px; height: 44px;
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px;
}
.module-title { font-weight: 700; font-size: 20px; }
.module-desc { color: var(--text-dim); font-size: 14px; line-height: 1.7; margin-bottom: 20px; }

/* Chunk highlight */
.chunk {
  display: inline; padding: 2px 6px; border-radius: 4px;
  font-weight: 600;
}
.chunk-verb { background: rgba(255,107,53,0.15); color: var(--accent); }
.chunk-noun { background: rgba(78,205,196,0.15); color: var(--a1); }
.chunk-phrase { background: rgba(108,92,231,0.15); color: var(--b1); }
.chunk-frame { background: rgba(244,114,182,0.15); color: var(--c1); }

/* Exercise */
.exercise-box {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px;
  margin-top: 16px;
}
.exercise-label {
  font-family: 'Space Mono', monospace;
  font-size: 11px; text-transform: uppercase;
  letter-spacing: 2px; color: var(--accent);
  margin-bottom: 12px;
}
.exercise-prompt {
  font-size: 16px; font-weight: 500;
  margin-bottom: 16px; line-height: 1.6;
}

/* Buttons */
.btn {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 10px 20px; border-radius: 10px;
  font-size: 14px; font-weight: 600;
  cursor: pointer; border: none;
  transition: all 0.2s;
}
.btn-primary {
  background: linear-gradient(135deg, var(--accent), #ff8c5a);
  color: #fff;
}
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(255,107,53,0.3); }
.btn-secondary {
  background: var(--surface2);
  color: var(--text); border: 1px solid var(--border);
}
.btn-secondary:hover { border-color: var(--accent); }
.btn-sm { padding: 6px 14px; font-size: 12px; }

/* Scenario cards */
.scenario-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px; margin-top: 16px;
}
.scenario-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px; padding: 20px;
  cursor: pointer; transition: all 0.25s;
}
.scenario-card:hover { border-color: var(--accent); transform: translateY(-2px); }
.scenario-card .emoji { font-size: 28px; margin-bottom: 8px; }
.scenario-card .name { font-weight: 700; font-size: 15px; margin-bottom: 4px; }
.scenario-card .desc { font-size: 13px; color: var(--text-dim); line-height: 1.5; }

/* Chunk practice */
.chunk-practice {
  display: flex; flex-wrap: wrap; gap: 8px;
  margin: 16px 0;
}
.chunk-pill {
  padding: 8px 16px; border-radius: 20px;
  font-size: 14px; font-weight: 500;
  cursor: pointer; transition: all 0.2s;
  border: 1px solid var(--border);
  background: var(--surface2);
  user-select: none;
}
.chunk-pill:hover { border-color: var(--accent); }
.chunk-pill.selected { background: rgba(255,107,53,0.15); border-color: var(--accent); color: var(--accent); }
.chunk-pill.correct { background: rgba(34,197,94,0.15); border-color: var(--success); color: var(--success); }
.chunk-pill.wrong { background: rgba(239,68,68,0.15); border-color: var(--error); color: var(--error); }

/* Answer area */
.answer-slots {
  display: flex; flex-wrap: wrap; gap: 8px;
  min-height: 48px; padding: 16px;
  border: 2px dashed var(--border);
  border-radius: 12px;
  margin: 12px 0;
  align-items: center;
}
.answer-slot {
  padding: 8px 16px; border-radius: 20px;
  font-size: 14px; font-weight: 500;
  background: rgba(255,107,53,0.1);
  color: var(--accent);
  cursor: pointer;
}
.answer-slot:hover { opacity: 0.7; }

/* Feedback */
.feedback {
  padding: 12px 16px; border-radius: 10px;
  font-size: 14px; margin-top: 12px;
  display: none;
}
.feedback.show { display: block; animation: fadeIn 0.3s; }
.feedback.success { background: rgba(34,197,94,0.1); color: var(--success); border: 1px solid rgba(34,197,94,0.2); }
.feedback.error { background: rgba(239,68,68,0.1); color: var(--error); border: 1px solid rgba(239,68,68,0.2); }
.feedback.info { background: rgba(69,183,209,0.1); color: var(--a2); border: 1px solid rgba(69,183,209,0.2); }

/* Respeak */
.respeak-area {
  text-align: center; padding: 24px;
}
.respeak-sentence {
  font-size: 22px; font-weight: 700;
  margin-bottom: 8px; line-height: 1.5;
}
.respeak-translation {
  font-size: 14px; color: var(--text-dim);
  margin-bottom: 20px;
}
.respeak-chunks {
  display: flex; flex-wrap: wrap; justify-content: center;
  gap: 6px; margin-bottom: 20px;
}
.respeak-chunk {
  padding: 6px 14px; border-radius: 8px;
  font-size: 14px; background: var(--surface2);
  border: 1px solid var(--border);
  transition: all 0.3s;
}
.respeak-chunk.highlight {
  background: rgba(255,107,53,0.15);
  border-color: var(--accent);
  color: var(--accent);
}
.play-btn {
  width: 56px; height: 56px;
  border-radius: 50%; border: 2px solid var(--accent);
  background: rgba(255,107,53,0.1);
  color: var(--accent); font-size: 22px;
  cursor: pointer; transition: all 0.2s;
  display: inline-flex; align-items: center; justify-content: center;
}
.play-btn:hover { background: var(--accent); color: #fff; }

/* Expansion */
.expansion-base {
  font-size: 18px; font-weight: 700;
  padding: 16px; background: var(--surface2);
  border-radius: 12px; text-align: center;
  margin-bottom: 16px;
  border-left: 3px solid var(--accent);
}
.expansion-list { list-style: none; }
.expansion-list li {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex; gap: 12px; align-items: baseline;
}
.expansion-list li:last-child { border-bottom: none; }
.expansion-connector {
  font-family: 'Space Mono', monospace;
  font-size: 12px; font-weight: 700;
  color: var(--accent); min-width: 100px;
}
.expansion-sentence { font-size: 14px; line-height: 1.6; }
.expansion-input {
  width: 100%; padding: 12px 16px;
  border-radius: 10px; border: 1px solid var(--border);
  background: var(--surface2); color: var(--text);
  font-size: 14px; font-family: inherit;
  margin-top: 12px;
}
.expansion-input:focus { outline: none; border-color: var(--accent); }

/* Collocation */
.collocation-grid {
  display: grid; grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}
@media (max-width: 600px) { .collocation-grid { grid-template-columns: 1fr; } }
.collocation-item {
  padding: 16px; border-radius: 12px;
  background: var(--surface2);
  border: 1px solid var(--border);
}
.collocation-verb {
  font-family: 'Space Mono', monospace;
  font-weight: 700; color: var(--accent);
  margin-bottom: 8px; font-size: 15px;
}
.collocation-examples {
  font-size: 13px; color: var(--text-dim); line-height: 1.8;
}

/* Tabs inside module */
.inner-tabs {
  display: flex; gap: 4px; margin-bottom: 20px;
  border-bottom: 1px solid var(--border);
  padding-bottom: 8px;
}
.inner-tab {
  padding: 6px 14px; border-radius: 8px;
  font-size: 13px; cursor: pointer;
  background: none; border: none;
  color: var(--text-dim); font-weight: 500;
  transition: all 0.2s;
}
.inner-tab:hover { color: var(--text); }
.inner-tab.active { color: var(--accent); background: rgba(255,107,53,0.1); }

.tab-content { display: none; }
.tab-content.active { display: block; }

/* Espresso Timer */
.espresso-timer {
  text-align: center; padding: 20px;
}
.timer-display {
  font-family: 'Space Mono', monospace;
  font-size: 64px; font-weight: 700;
  color: var(--accent);
  margin: 16px 0;
}
.timer-round {
  font-size: 14px; color: var(--text-dim);
  margin-bottom: 8px;
}
.timer-topic {
  font-size: 16px; font-weight: 600;
  margin-bottom: 20px;
}

/* Progress */
.progress-bar {
  height: 4px; background: var(--surface2);
  border-radius: 2px; overflow: hidden;
  margin: 12px 0;
}
.progress-fill {
  height: 100%; border-radius: 2px;
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  transition: width 0.5s ease;
}

/* Dictation */
.dictation-area textarea {
  width: 100%; min-height: 100px;
  padding: 16px; border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--surface2); color: var(--text);
  font-size: 15px; font-family: inherit;
  line-height: 1.7; resize: vertical;
}
.dictation-area textarea:focus { outline: none; border-color: var(--accent); }

/* Method tag */
.method-tag {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 4px 10px; border-radius: 6px;
  font-size: 11px; font-weight: 700;
  background: rgba(255,209,102,0.1);
  color: var(--accent2);
  margin-right: 4px;
}

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

/* Responsive */
@media (max-width: 640px) {
  .nav-tabs { display: none; }
  .module { padding: 20px; }
  .level-grid { grid-template-columns: repeat(3, 1fr); }
}

.mobile-nav {
  display: none;
  position: fixed; bottom: 0; left: 0; right: 0;
  background: rgba(10,10,15,0.95);
  backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  padding: 8px; z-index: 100;
}
@media (max-width: 640px) {
  .mobile-nav { display: flex; justify-content: space-around; }
  main { padding-bottom: 70px; }
}
.mobile-nav button {
  background: none; border: none; color: var(--text-dim);
  font-size: 10px; padding: 6px; cursor: pointer;
  display: flex; flex-direction: column; align-items: center; gap: 2px;
}
.mobile-nav button.active { color: var(--accent); }
.mobile-nav button span { font-size: 20px; }

/* Hide hint */
.hint-toggle { cursor: pointer; color: var(--text-dim); font-size: 13px; }
.hint-toggle:hover { color: var(--text); }
.hint-content { display: none; margin-top: 8px; font-size: 13px; color: var(--text-dim); line-height: 1.6; }
.hint-content.show { display: block; }
</style>
</head>
<body>

<nav class="nav">
  <div class="nav-logo">è‹±èªåå°„åŠ›</div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showSection('home')">é¦–é </button>
    <button class="nav-tab" onclick="showSection('chunks')">èªå¡Šç·´ç¿’</button>
    <button class="nav-tab" onclick="showSection('respeak')">Respeak</button>
    <button class="nav-tab" onclick="showSection('expand')">æ“´å¥è¨“ç·´</button>
    <button class="nav-tab" onclick="showSection('espresso')">æ¿ƒç¸®å’–å•¡æ³•</button>
    <button class="nav-tab" onclick="showSection('upgrade')">èªæ„Ÿå‡ç´š</button>
  </div>
</nav>

<div class="mobile-nav">
  <button class="active" onclick="showSection('home')"><span>ğŸ </span>é¦–é </button>
  <button onclick="showSection('chunks')"><span>ğŸ§©</span>èªå¡Š</button>
  <button onclick="showSection('respeak')"><span>ğŸ”</span>Respeak</button>
  <button onclick="showSection('expand')"><span>ğŸ“</span>æ“´å¥</button>
  <button onclick="showSection('espresso')"><span>â˜•</span>æ¿ƒç¸®</button>
  <button onclick="showSection('upgrade')"><span>â¬†ï¸</span>å‡ç´š</button>
</div>

<main>

<!-- ===== HOME ===== -->
<section class="section active" id="sec-home">
  <div class="hero">
    <h1>å¾ A1 åˆ° C1 çš„<br><span>è‹±èªå£èªªå­¸ç¿’è·¯å¾‘</span></h1>
    <p>åŸºæ–¼èªå¡Šå­¸ç¿’æ³•ï¼Œçµåˆ Respeakã€æ“´å¥ã€æ¿ƒç¸®å’–å•¡æ³•ç­‰è¨“ç·´æ–¹å¼ï¼Œç³»çµ±åŒ–æå‡ä½ çš„è‹±æ–‡å£èªªåå°„åŠ›ã€‚</p>
  </div>

  <div class="level-grid">
    <div class="level-card" data-level="a1" onclick="showSection('chunks')">
      <div class="badge">A1</div>
      <div class="title">èµ·æ­¥èˆ‡èªæ„Ÿå»ºç«‹</div>
      <div class="sub">ç†è§£èªå¡Šæ¦‚å¿µ<br>æ“ºè„«å™ªéŸ³æ„Ÿ</div>
    </div>
    <div class="level-card" data-level="a2" onclick="showSection('chunks')">
      <div class="badge">A2</div>
      <div class="title">æ„‰å¿«çš„å»ºæ§‹æœŸ</div>
      <div class="sub">ç´¯ç©æ­é…è©<br>å£è…”è‚Œè‚‰è¨˜æ†¶</div>
    </div>
    <div class="level-card" data-level="b1" onclick="showSection('expand')">
      <div class="badge">B1</div>
      <div class="title">èªè¨€æ•´åˆæœŸ</div>
      <div class="sub">æ“´å¥ç·´ç¿’<br>æ¸…æ™°è¡¨é”æƒ³æ³•</div>
    </div>
    <div class="level-card" data-level="b2" onclick="showSection('upgrade')">
      <div class="badge">B2</div>
      <div class="title">è¡¨é”è‡ªå‹•åŒ–</div>
      <div class="sub">æµæš¢åº¦ï¼‹æ­£ç¢ºæ€§<br>ç”¨å­—å¤šå…ƒæ€§</div>
    </div>
    <div class="level-card" data-level="c1" onclick="showSection('upgrade')">
      <div class="badge">C1</div>
      <div class="title">èªæ„Ÿç²¾ä¿®æœŸ</div>
      <div class="sub">Right word<br>Right place</div>
    </div>
    <div class="level-card" data-level="c2" onclick="showSection('upgrade')">
      <div class="badge">C2</div>
      <div class="title">é¢¨æ ¼å…§åŒ–æœŸ</div>
      <div class="sub">å»ºç«‹å€‹äºº<br>èªè¨€é¢¨æ ¼</div>
    </div>
  </div>

  <div class="content-area">
    <div class="module" style="margin-top:40px;">
      <div class="module-header">
        <div class="module-icon" style="background:rgba(255,107,53,0.1);color:var(--accent);">ğŸ“‹</div>
        <div class="module-title">å­¸ç¿’æ–¹æ³•ç¸½è¦½</div>
      </div>
      <div class="module-desc">æœ¬æ•™ææ•´åˆä»¥ä¸‹æ ¸å¿ƒå­¸ç¿’æ³•ï¼Œæ¯ç¨®æ–¹æ³•å°æ‡‰ä¸åŒç¨‹åº¦çš„å£èªªéœ€æ±‚ï¼š</div>
      <div class="scenario-grid">
        <div class="scenario-card" onclick="showSection('chunks')">
          <div class="emoji">ğŸ§©</div>
          <div class="name">åˆ‡å¥å­ + èªå¡Šè¾¨è­˜</div>
          <div class="desc">A1~A2ï½œæŠŠä¸€é•·ä¸²è²éŸ³åˆ‡åˆ†ç‚ºæœ‰æ„ç¾©çš„èªå¡Šå–®ä½ï¼Œå»ºç«‹èªè¨€è¨˜æ†¶é»ã€‚</div>
        </div>
        <div class="scenario-card" onclick="showSection('respeak')">
          <div class="emoji">ğŸ”</div>
          <div class="name">Respeak æ³•</div>
          <div class="desc">A1~C1ï½œè·Ÿè¿°ç·´ç¿’ï¼Œå»ºç«‹å£è…”è‚Œè‚‰è¨˜æ†¶ï¼ŒåŒæ™‚æå‡è½åŠ›èˆ‡å­—å½™é‡ã€‚</div>
        </div>
        <div class="scenario-card" onclick="showSection('expand')">
          <div class="emoji">ğŸ“</div>
          <div class="name">æ“´å¥ç·´ç¿’ + è½‰å ´æ³•</div>
          <div class="desc">B1ï½œç”¨é€£æ¥è©å°‡çŸ­å¥æ“´å……ç‚ºå®Œæ•´è¡¨é”ï¼Œæ•´åˆè¢«å‹•çŸ¥è­˜ç‚ºä¸»å‹•è¼¸å‡ºã€‚</div>
        </div>
        <div class="scenario-card" onclick="showSection('espresso')">
          <div class="emoji">â˜•</div>
          <div class="name">æ¿ƒç¸®å’–å•¡æ³• (Espresso)</div>
          <div class="desc">B2ï½œåŒä¸€ä¸»é¡Œè¬›ä¸‰æ¬¡ï¼ˆ60sâ†’50sâ†’40sï¼‰ï¼Œå…§åŒ–æ™‚æ…‹èˆ‡æ­é…è©æ­£ç¢ºæ€§ã€‚</div>
        </div>
        <div class="scenario-card" onclick="showSection('chunks')">
          <div class="emoji">ğŸŒ­</div>
          <div class="name">å¤§è…¸åŒ…å°è…¸æ³•</div>
          <div class="desc">A2~B1ï½œç”¨å¥å‹æ¡†æ¶åŒ…è£¹èªå¡Šï¼Œå¿«é€Ÿçµ„è£å‡ºé“åœ°çš„å¥å­ã€‚</div>
        </div>
        <div class="scenario-card" onclick="showSection('upgrade')">
          <div class="emoji">ğŸ”¬</div>
          <div class="name">èªæ„Ÿç²¾ä¿® + æ¼¸é€²å¼</div>
          <div class="desc">B2~C1ï½œå¾ B1 èªªæ³•å‡ç´šåˆ°æ¯èªäººå£«çš„è‡ªç„¶è¡¨é”ï¼ŒRight word, right placeã€‚</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== CHUNKS ===== -->
<section class="section" id="sec-chunks">
  <div class="content-area">
    <div class="module">
      <div class="module-header">
        <div class="module-icon" style="background:rgba(78,205,196,0.1);color:var(--a1);">ğŸ§©</div>
        <div class="module-title">èªå¡Šè¾¨è­˜èˆ‡åˆ‡å¥ç·´ç¿’</div>
      </div>
      <div class="module-desc">
        è‹±æ–‡å¥å­æ˜¯ä¸€ç¾¤<strong>èªå¡Š (Chunks)</strong> çš„çµ„åˆï¼Œä¸æ˜¯é€å­—æ‹¼æ¹Šã€‚å…ˆå­¸æœƒè¾¨è­˜èªå¡Šï¼Œæ‰èƒ½æ“ºè„«ã€Œä¸€ä¸²å™ªéŸ³ã€çš„æ„Ÿè¦ºã€‚
      </div>

      <div class="inner-tabs">
        <button class="inner-tab active" onclick="switchTab(this,'chunk-tab','chunk-identify')">èªå¡Šè¾¨è­˜</button>
        <button class="inner-tab" onclick="switchTab(this,'chunk-tab','chunk-collocation')">æ­é…è©</button>
        <button class="inner-tab" onclick="switchTab(this,'chunk-tab','chunk-sausage')">å¤§è…¸åŒ…å°è…¸</button>
        <button class="inner-tab" onclick="switchTab(this,'chunk-tab','chunk-scenarios')">æƒ…å¢ƒèªå¡Š</button>
      </div>

      <!-- Tab: èªå¡Šè¾¨è­˜ -->
      <div class="tab-content chunk-tab active" id="chunk-identify">
        <div class="exercise-box">
          <div class="exercise-label">ç·´ç¿’ â€” åˆ‡å¥å­</div>
          <div class="exercise-prompt">
            æŠŠä¸‹é¢çš„å¥å­åˆ‡åˆ†ç‚ºèªå¡Šå–®ä½ï¼Œé»é¸ä½ èªç‚ºæ˜¯ã€Œä¸€çµ„ã€çš„å­—ï¼š
          </div>
          <div id="chunk-exercise-1" class="chunk-practice"></div>
          <div id="chunk-answer-1" class="answer-slots"></div>
          <div style="display:flex;gap:8px;margin-top:12px;">
            <button class="btn btn-primary btn-sm" onclick="checkChunks(1)">æª¢æŸ¥ç­”æ¡ˆ</button>
            <button class="btn btn-secondary btn-sm" onclick="resetChunks(1)">é‡ç½®</button>
            <button class="btn btn-secondary btn-sm" onclick="nextChunkExercise()">ä¸‹ä¸€é¡Œ â†’</button>
          </div>
          <div id="chunk-feedback-1" class="feedback"></div>
        </div>
      </div>

      <!-- Tab: æ­é…è© -->
      <div class="tab-content chunk-tab" id="chunk-collocation">
        <div class="module-desc">æ­é…è© (Collocation) æ˜¯æ¯èªäººå£«å¤§è…¦ä¸­å„²å­˜çš„èªå¡Šçµ„åˆã€‚ä¾‹å¦‚ Beat é€™å€‹å‹•è©å¯ä»¥æ­é…ï¼š</div>
        <div class="collocation-grid">
          <div class="collocation-item">
            <div class="collocation-verb">BEAT + ___</div>
            <div class="collocation-examples">
              ğŸ¥ beat the drum â€” æ‰“é¼“<br>
              ğŸ¥š beat the egg â€” æŠŠè›‹æ”ªå‹»<br>
              ğŸš— beat the traffic â€” é¿é–‹è»Šæ½®<br>
              âš™ï¸ beat the system â€” é‘½ç³»çµ±æ¼æ´
            </div>
          </div>
          <div class="collocation-item">
            <div class="collocation-verb">TAKE + ___</div>
            <div class="collocation-examples">
              â˜• take a break â€” ä¼‘æ¯ä¸€ä¸‹<br>
              âœˆï¸ take a trip â€” å»æ—…è¡Œ<br>
              ğŸ“¸ take a photo â€” æ‹ç…§<br>
              ğŸ¤” take a chance â€” å†’éšªè©¦è©¦
            </div>
          </div>
          <div class="collocation-item">
            <div class="collocation-verb">MAKE + ___</div>
            <div class="collocation-examples">
              ğŸ”„ make a comeback â€” é€†è½‰å‹<br>
              ğŸ¯ make a decision â€” åšæ±ºå®š<br>
              ğŸ¤ make a deal â€” é”æˆå”è­°<br>
              ğŸ˜Š make a difference â€” ç”¢ç”Ÿå½±éŸ¿
            </div>
          </div>
          <div class="collocation-item">
            <div class="collocation-verb">HAVE + ___</div>
            <div class="collocation-examples">
              ğŸ˜´ have some rest â€” ä¼‘æ¯ä¸€ä¸‹<br>
              ğŸµ have some tea â€” å–èŒ¶<br>
              ğŸ’¬ have a conversation â€” èŠä¸€èŠ<br>
              ğŸ‰ have a good time â€” ç©å¾—é–‹å¿ƒ
            </div>
          </div>
        </div>

        <div class="exercise-box" style="margin-top:20px;">
          <div class="exercise-label">ç·´ç¿’ â€” æ­é…è©é…å°</div>
          <div class="exercise-prompt" id="collocation-q">é¸å‡ºæ­£ç¢ºçš„æ­é…è©ï¼š</div>
          <div id="collocation-options" class="chunk-practice"></div>
          <div id="collocation-feedback" class="feedback"></div>
          <button class="btn btn-secondary btn-sm" style="margin-top:8px;" onclick="nextCollocation()">ä¸‹ä¸€é¡Œ â†’</button>
        </div>
      </div>

      <!-- Tab: å¤§è…¸åŒ…å°è…¸ -->
      <div class="tab-content chunk-tab" id="chunk-sausage">
        <div class="module-desc">
          <span class="method-tag">ğŸŒ­ å¤§è…¸åŒ…å°è…¸æ³•</span>
          ç”¨å¥å‹æ¡†æ¶ï¼ˆå¤§è…¸ï¼‰åŒ…è£¹èªå¡Šï¼ˆå°è…¸ï¼‰ï¼Œå¿«é€Ÿçµ„è£å‡ºè‡ªç„¶çš„è‹±æ–‡å¥å­ã€‚
        </div>
        <div class="exercise-box">
          <div class="exercise-label">å¥å‹æ¡†æ¶ + èªå¡Š = å®Œæ•´å¥å­</div>
          <div style="margin-bottom:16px;">
            <div style="margin-bottom:12px;">
              <span class="chunk chunk-frame">Do you happen to know</span> + <span class="chunk chunk-noun">where the restroom is</span>
              <div style="font-size:13px;color:var(--text-dim);margin-top:4px;">â†’ è«‹å•ä½ çŸ¥é“å»æ‰€åœ¨å“ªè£¡å—ï¼Ÿ</div>
            </div>
            <div style="margin-bottom:12px;">
              <span class="chunk chunk-frame">I was wondering</span> + <span class="chunk chunk-noun">if you could help me</span>
              <div style="font-size:13px;color:var(--text-dim);margin-top:4px;">â†’ æˆ‘åœ¨æƒ³ä½ æ˜¯å¦èƒ½å¹«æˆ‘</div>
            </div>
            <div style="margin-bottom:12px;">
              <span class="chunk chunk-frame">Would you like to</span> + <span class="chunk chunk-verb">grab a quick bite</span>
              <div style="font-size:13px;color:var(--text-dim);margin-top:4px;">â†’ ä½ è¦ä¸è¦å¿«é€Ÿåƒå€‹æ±è¥¿ï¼Ÿ</div>
            </div>
          </div>
          <div class="exercise-prompt">ä½ çš„å›åˆ â€” ç”¨æ¡†æ¶é€ å¥ï¼š</div>
          <div style="padding:12px;background:var(--surface);border-radius:10px;margin-bottom:12px;">
            æ¡†æ¶ï¼š<span class="chunk chunk-frame">I'm a big fan of</span> + ï¼Ÿ
          </div>
          <input class="expansion-input" id="sausage-input" placeholder="è¼¸å…¥ä½ çš„å¥å­ï¼Œä¾‹å¦‚ï¼šI'm a big fan of night markets" />
          <div style="display:flex;gap:8px;margin-top:8px;">
            <button class="btn btn-primary btn-sm" onclick="checkSausage()">é€å‡º</button>
            <span class="hint-toggle" onclick="toggleHint('sausage-hint')">ğŸ’¡ çœ‹ç¯„ä¾‹</span>
          </div>
          <div class="hint-content" id="sausage-hint">
            I'm a big fan of bubble tea. / I'm a big fan of hiking. / I'm a big fan of this podcast.
          </div>
          <div id="sausage-feedback" class="feedback"></div>
        </div>

        <div class="exercise-box" style="margin-top:16px;">
          <div class="exercise-label">æ›´å¤šå¸¸ç”¨å¥å‹æ¡†æ¶</div>
          <div style="display:grid;gap:8px;">
            <div style="padding:10px 14px;background:var(--surface);border-radius:8px;font-size:14px;">
              <span class="chunk chunk-frame">One reason why I ___ is that...</span>
              <span style="color:var(--text-dim);font-size:12px;margin-left:8px;">æˆ‘___çš„åŸå› æ˜¯...</span>
            </div>
            <div style="padding:10px 14px;background:var(--surface);border-radius:8px;font-size:14px;">
              <span class="chunk chunk-frame">It's + adj + to + V...</span>
              <span style="color:var(--text-dim);font-size:12px;margin-left:8px;">åš...æ˜¯...çš„</span>
            </div>
            <div style="padding:10px 14px;background:var(--surface);border-radius:8px;font-size:14px;">
              <span class="chunk chunk-frame">I've always wanted to...</span>
              <span style="color:var(--text-dim);font-size:12px;margin-left:8px;">æˆ‘ä¸€ç›´å¾ˆæƒ³...</span>
            </div>
            <div style="padding:10px 14px;background:var(--surface);border-radius:8px;font-size:14px;">
              <span class="chunk chunk-frame">The thing I like most about ___ is...</span>
              <span style="color:var(--text-dim);font-size:12px;margin-left:8px;">æˆ‘æœ€å–œæ­¡___çš„åœ°æ–¹æ˜¯...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: æƒ…å¢ƒèªå¡Š -->
      <div class="tab-content chunk-tab" id="chunk-scenarios">
        <div class="module-desc">å¾ä½ çš„æ—¥å¸¸ã€èº«é‚Šçš„äººã€ä½ çš„æ„›å¥½å‡ºç™¼ï¼ˆMe, Myself & I åŸå‰‡ï¼‰ï¼Œä»¥ä¸‹æ˜¯å¸¸è¦‹æƒ…å¢ƒçš„æ ¸å¿ƒèªå¡Šï¼š</div>
        <div class="scenario-grid">
          <div class="scenario-card" onclick="loadScenario('nightmarket')">
            <div class="emoji">ğŸ®</div>
            <div class="name">é€›å¤œå¸‚</div>
            <div class="desc">food stalls, grab a quick bite, packed with people, lively atmosphere</div>
          </div>
          <div class="scenario-card" onclick="loadScenario('tennis')">
            <div class="emoji">ğŸ¾</div>
            <div class="name">çœ‹ç¶²çƒ</div>
            <div class="desc">make a comeback, score a service break, intense game, tough draw</div>
          </div>
          <div class="scenario-card" onclick="loadScenario('commute')">
            <div class="emoji">ğŸš‡</div>
            <div class="name">é€šå‹¤æ—¥å¸¸</div>
            <div class="desc">beat the traffic, leave early, a longer commute, rush hour</div>
          </div>
          <div class="scenario-card" onclick="loadScenario('work')">
            <div class="emoji">ğŸ’¼</div>
            <div class="name">åŠ ç­å·¥ä½œ</div>
            <div class="desc">work late, wrap up, got no choice, tight deadline</div>
          </div>
          <div class="scenario-card" onclick="loadScenario('coffee')">
            <div class="emoji">â˜•</div>
            <div class="name">å’–å•¡æ–‡åŒ–</div>
            <div class="desc">pour-over, single origin, light roast, flavor notes</div>
          </div>
          <div class="scenario-card" onclick="loadScenario('travel')">
            <div class="emoji">âœˆï¸</div>
            <div class="name">æ—…è¡Œé«”é©—</div>
            <div class="desc">check in, go through customs, jet lag, travel light</div>
          </div>
        </div>
        <div id="scenario-detail" style="margin-top:20px;"></div>
      </div>
    </div>
  </div>
</section>

<!-- ===== RESPEAK ===== -->
<section class="section" id="sec-respeak">
  <div class="content-area">
    <div class="module">
      <div class="module-header">
        <div class="module-icon" style="background:rgba(69,183,209,0.1);color:var(--a2);">ğŸ”</div>
        <div class="module-title">Respeak è·Ÿè¿°ç·´ç¿’</div>
      </div>
      <div class="module-desc">
        <span class="method-tag">ğŸ” Respeak æ³•</span>
        è½ä¸€å¥ã€è·Ÿä¸€å¥ï¼Œå»ºç«‹å£è…”è‚Œè‚‰è¨˜æ†¶ã€‚å…ˆä¸ç”¨ç†è§£æ–‡æ³•ï¼Œè®“ä½ çš„å˜´å·´ã€Œè¨˜ä½ã€é€™äº›å¥å­çš„ç¯€å¥å’Œé‡éŸ³ã€‚ç”¨ TTS æ’­æ”¾å¾Œï¼Œæš«åœä¸¦å¤§è²è·Ÿè®€ã€‚
      </div>

      <div class="inner-tabs">
        <button class="inner-tab active" onclick="switchTab(this,'respeak-tab','respeak-perfect')">å®Œæˆå¼å¥å‹</button>
        <button class="inner-tab" onclick="switchTab(this,'respeak-tab','respeak-daily')">æ—¥å¸¸çŸ­å¥</button>
        <button class="inner-tab" onclick="switchTab(this,'respeak-tab','respeak-scenario')">æƒ…å¢ƒæœƒè©±</button>
      </div>

      <div class="tab-content respeak-tab active" id="respeak-perfect">
        <div id="respeak-container" class="respeak-area"></div>
        <div style="display:flex;justify-content:center;gap:8px;margin-top:8px;">
          <button class="btn btn-secondary btn-sm" onclick="prevRespeak()">â† ä¸Šä¸€å¥</button>
          <button class="btn btn-primary btn-sm" onclick="speakCurrent()">ğŸ”Š æ’­æ”¾</button>
          <button class="btn btn-secondary btn-sm" onclick="nextRespeak()">ä¸‹ä¸€å¥ â†’</button>
        </div>
        <div class="progress-bar" style="margin-top:16px;">
          <div class="progress-fill" id="respeak-progress" style="width:14%"></div>
        </div>
      </div>

      <div class="tab-content respeak-tab" id="respeak-daily">
        <div id="respeak-daily-container" class="respeak-area"></div>
        <div style="display:flex;justify-content:center;gap:8px;margin-top:8px;">
          <button class="btn btn-secondary btn-sm" onclick="prevRespeakDaily()">â† ä¸Šä¸€å¥</button>
          <button class="btn btn-primary btn-sm" onclick="speakCurrentDaily()">ğŸ”Š æ’­æ”¾</button>
          <button class="btn btn-secondary btn-sm" onclick="nextRespeakDaily()">ä¸‹ä¸€å¥ â†’</button>
        </div>
      </div>

      <div class="tab-content respeak-tab" id="respeak-scenario">
        <div class="module-desc">é¸æ“‡ä¸€å€‹æƒ…å¢ƒï¼Œç·´ç¿’è©²æƒ…å¢ƒä¸‹çš„ Respeakï¼š</div>
        <div class="scenario-grid">
          <div class="scenario-card" onclick="loadRespeakScenario('ordering')">
            <div class="emoji">ğŸœ</div>
            <div class="name">é»é¤</div>
            <div class="desc">åœ¨é¤å»³æˆ–å°åƒæ”¤é»é¤çš„å¸¸ç”¨å¥</div>
          </div>
          <div class="scenario-card" onclick="loadRespeakScenario('shopping')">
            <div class="emoji">ğŸ›ï¸</div>
            <div class="name">è³¼ç‰©</div>
            <div class="desc">é€›è¡—ã€è©¢åƒ¹ã€æ®ºåƒ¹çš„å¯¦ç”¨å¥å‹</div>
          </div>
          <div class="scenario-card" onclick="loadRespeakScenario('meeting')">
            <div class="emoji">ğŸ¤</div>
            <div class="name">æœƒè­°é–‹å ´</div>
            <div class="desc">è·å ´æœƒè­°ä¸­å¸¸ç”¨çš„é–‹å ´èˆ‡å›æ‡‰</div>
          </div>
          <div class="scenario-card" onclick="loadRespeakScenario('smalltalk')">
            <div class="emoji">ğŸ’¬</div>
            <div class="name">é–’èŠå¯’æš„</div>
            <div class="desc">èˆ‡åŒäº‹æˆ–æ–°æœ‹å‹é–’èŠçš„è‡ªç„¶è¡¨é”</div>
          </div>
        </div>
        <div id="respeak-scenario-detail" style="margin-top:16px;"></div>
      </div>
    </div>
  </div>
</section>

<!-- ===== EXPAND ===== -->
<section class="section" id="sec-expand">
  <div class="content-area">
    <div class="module">
      <div class="module-header">
        <div class="module-icon" style="background:rgba(108,92,231,0.1);color:var(--b1);">ğŸ“</div>
        <div class="module-title">æ“´å¥è¨“ç·´ + è½‰å ´æ³•</div>
      </div>
      <div class="module-desc">
        <span class="method-tag">ğŸ“ æ“´å¥ç·´ç¿’</span>
        <span class="method-tag">ğŸ”— è½‰å ´æ³•</span>
        B1 çš„æ ¸å¿ƒä»»å‹™ï¼šæŠŠç°¡çŸ­çš„å¥å­ç”¨é€£æ¥è©æ“´å……ç‚ºå®Œæ•´çš„æƒ³æ³•è¡¨é”ã€‚ä¸æ˜¯åªè¬›å‡ºå¥å­ï¼Œè€Œæ˜¯æ¸…æ™°åœ°ã€Œå£è¡¨æˆ‘å¿ƒã€ã€‚
      </div>

      <div id="expansion-exercises"></div>
    </div>
  </div>
</section>

<!-- ===== ESPRESSO ===== -->
<section class="section" id="sec-espresso">
  <div class="content-area">
    <div class="module">
      <div class="module-header">
        <div class="module-icon" style="background:rgba(168,85,247,0.1);color:var(--b2);">â˜•</div>
        <div class="module-title">æ¿ƒç¸®å’–å•¡æ³• (Espresso Method)</div>
      </div>
      <div class="module-desc">
        <span class="method-tag">â˜• Espresso</span>
        åŒä¸€å€‹ä¸»é¡Œè¬›ä¸‰æ¬¡ï¼Œæ™‚é–“éæ¸›ï¼š60 ç§’ â†’ 50 ç§’ â†’ 40 ç§’ã€‚é€éåè¦†å£“ç¸®ï¼Œå…§åŒ–æ–‡æ³•æ­£ç¢ºæ€§ï¼ˆæ™‚æ…‹ã€å–®è¤‡æ•¸ï¼‰èˆ‡æµæš¢åº¦ã€‚
      </div>

      <div class="exercise-box">
        <div class="exercise-label">é¸æ“‡ä¸€å€‹ä¸»é¡Œé–‹å§‹ç·´ç¿’</div>
        <div class="scenario-grid" style="margin-top:8px;">
          <div class="scenario-card" onclick="startEspresso('ä»‹ç´¹ä½ æœ€å–œæ­¡çš„å¤œå¸‚','Describe your favorite night market')">
            <div class="emoji">ğŸ®</div>
            <div class="name">æˆ‘æœ€æ„›çš„å¤œå¸‚</div>
          </div>
          <div class="scenario-card" onclick="startEspresso('æè¿°ä½ çš„æ—¥å¸¸é€šå‹¤','Describe your daily commute')">
            <div class="emoji">ğŸš‡</div>
            <div class="name">æˆ‘çš„é€šå‹¤æ—¥å¸¸</div>
          </div>
          <div class="scenario-card" onclick="startEspresso('èªªæ˜ä½ ç‚ºä»€éº¼æ¬å®¶','Explain why you moved')">
            <div class="emoji">ğŸ </div>
            <div class="name">æˆ‘æ¬å®¶çš„åŸå› </div>
          </div>
          <div class="scenario-card" onclick="startEspresso('åˆ†äº«ä½ çš„é€±æœ«è¨ˆç•«','Share your weekend plans')">
            <div class="emoji">ğŸŒ´</div>
            <div class="name">æˆ‘çš„é€±æœ«è¨ˆç•«</div>
          </div>
          <div class="scenario-card" onclick="startEspresso('æè¿°ä½ çš„å·¥ä½œ','Describe your job')">
            <div class="emoji">ğŸ’¼</div>
            <div class="name">æˆ‘çš„å·¥ä½œå…§å®¹</div>
          </div>
          <div class="scenario-card" onclick="startEspresso('ä»‹ç´¹ä½ çš„èˆˆè¶£','Talk about your hobbies')">
            <div class="emoji">ğŸ¯</div>
            <div class="name">æˆ‘çš„èˆˆè¶£æ„›å¥½</div>
          </div>
        </div>
      </div>

      <div id="espresso-active" style="display:none;" class="exercise-box">
        <div class="espresso-timer">
          <div class="timer-round" id="espresso-round">ç¬¬ 1 è¼ª / 3</div>
          <div class="timer-topic" id="espresso-topic"></div>
          <div class="timer-display" id="espresso-time">60</div>
          <div style="display:flex;gap:8px;justify-content:center;">
            <button class="btn btn-primary" id="espresso-start-btn" onclick="toggleEspresso()">â–¶ é–‹å§‹</button>
            <button class="btn btn-secondary" onclick="resetEspresso()">é‡ç½®</button>
          </div>
          <div style="margin-top:16px;font-size:13px;color:var(--text-dim);">
            ğŸ’¡ æç¤ºï¼šæ¯ä¸€è¼ªçµæŸå¾Œï¼Œæ€è€ƒå“ªäº›åœ°æ–¹å¯ä»¥èªªå¾—æ›´ç²¾æº–ã€æ›´æµæš¢ï¼Œç„¶å¾Œåœ¨ä¸‹ä¸€è¼ªæ”¹å–„ã€‚
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== UPGRADE ===== -->
<section class="section" id="sec-upgrade">
  <div class="content-area">
    <div class="module">
      <div class="module-header">
        <div class="module-icon" style="background:rgba(244,114,182,0.1);color:var(--c1);">â¬†ï¸</div>
        <div class="module-title">èªæ„Ÿå‡ç´š â€” å¾ B1 åˆ° C1</div>
      </div>
      <div class="module-desc">
        <span class="method-tag">ğŸ”¬ æ¼¸é€²å¼å­¸ç¿’æ³•</span>
        Right word, right place â€” ä¸åªæ˜¯è¬›å¾—å‡ºä¾†ï¼Œè€Œæ˜¯è¬›åˆ°ä½ã€‚æ¯”è¼ƒ B1 çš„èªªæ³•å’Œ C1 çš„è‡ªç„¶è¡¨é”ï¼ŒåŸ¹é¤Šèªæ„Ÿã€‚
      </div>

      <div class="inner-tabs">
        <button class="inner-tab active" onclick="switchTab(this,'upgrade-tab','upgrade-compare')">B1 â†’ C1 å°æ¯”</button>
        <button class="inner-tab" onclick="switchTab(this,'upgrade-tab','upgrade-lexical')">ç”¨å­—å¤šå…ƒæ€§</button>
        <button class="inner-tab" onclick="switchTab(this,'upgrade-tab','upgrade-dictation')">è½å¯«ç²¾ä¿®</button>
      </div>

      <div class="tab-content upgrade-tab active" id="upgrade-compare">
        <div id="upgrade-pairs"></div>
      </div>

      <div class="tab-content upgrade-tab" id="upgrade-lexical">
        <div class="module-desc">ä¸è¦æ°¸é åªç”¨åŒä¸€å€‹å­—ã€‚ä»¥ä¸‹æ˜¯å¸¸è¦‹æ¦‚å¿µçš„å¤šå…ƒè¡¨é”æ–¹å¼ï¼š</div>
        <div id="lexical-cards"></div>
      </div>

      <div class="tab-content upgrade-tab" id="upgrade-dictation">
        <div class="module-desc">
          <span class="method-tag">âœï¸ è½å¯«ç·´ç¿’</span>
          æ’­æ”¾ä¸€æ®µæ¯èªäººå£«çš„è‡ªç„¶å£èªï¼Œå¯«ä¸‹ä½ è½åˆ°çš„å…§å®¹ã€‚æ³¨æ„æ–·å¥ä½ç½®å’Œèªå¡Šé‚Šç•Œã€‚
        </div>
        <div class="exercise-box">
          <div class="exercise-label">è½å¯«ç·´ç¿’</div>
          <div class="exercise-prompt" id="dictation-prompt">é»æ“Šæ’­æ”¾ï¼Œè½å®Œå¾Œåœ¨ä¸‹æ–¹å¯«å‡ºä½ è½åˆ°çš„å¥å­ã€‚</div>
          <button class="btn btn-primary btn-sm" onclick="playDictation()" style="margin-bottom:12px;">ğŸ”Š æ’­æ”¾å¥å­</button>
          <div class="dictation-area">
            <textarea id="dictation-input" placeholder="åœ¨é€™è£¡å¯«ä¸‹ä½ è½åˆ°çš„å…§å®¹..."></textarea>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px;">
            <button class="btn btn-primary btn-sm" onclick="checkDictation()">å°ç­”æ¡ˆ</button>
            <button class="btn btn-secondary btn-sm" onclick="nextDictation()">ä¸‹ä¸€é¡Œ â†’</button>
          </div>
          <div id="dictation-feedback" class="feedback"></div>
        </div>
      </div>
    </div>
  </div>
</section>

</main>

<script>
// ===== NAVIGATION =====
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById('sec-' + id).classList.add('active');
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.mobile-nav button').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => { if(t.textContent.includes(getTabName(id))) t.classList.add('active'); });
  document.querySelectorAll('.mobile-nav button').forEach(t => { if(t.textContent.includes(getMobileTabName(id))) t.classList.add('active'); });
  window.scrollTo(0,0);
}
function getTabName(id) { return {home:'é¦–é ',chunks:'èªå¡Š',respeak:'Respeak',expand:'æ“´å¥',espresso:'æ¿ƒç¸®',upgrade:'èªæ„Ÿ'}[id]||''; }
function getMobileTabName(id) { return {home:'é¦–é ',chunks:'èªå¡Š',respeak:'Respeak',expand:'æ“´å¥',espresso:'æ¿ƒç¸®',upgrade:'å‡ç´š'}[id]||''; }

function switchTab(el, tabClass, tabId) {
  el.parentElement.querySelectorAll('.inner-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.querySelectorAll('.' + tabClass).forEach(t => t.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
}

function toggleHint(id) {
  document.getElementById(id).classList.toggle('show');
}

// ===== TTS =====
function speak(text, rate=0.9) {
  if('speechSynthesis' in window) {
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'en-US'; u.rate = rate; u.pitch = 1;
    speechSynthesis.speak(u);
  }
}

// ===== CHUNK EXERCISES =====
const chunkExercises = [
  { sentence: "When the deadline gets closer I try to focus on one task at a time",
    chunks: [["When","the","deadline","gets","closer"],["I","try","to"],["focus","on"],["one","task"],["at","a","time"]] },
  { sentence: "I have been to Tokyo many times and I always enjoy the food there",
    chunks: [["I","have","been","to"],["Tokyo"],["many","times"],["and","I","always"],["enjoy","the","food"],["there"]] },
  { sentence: "Do you happen to know where the nearest convenience store is",
    chunks: [["Do","you","happen","to","know"],["where"],["the","nearest"],["convenience","store"],["is"]] },
  { sentence: "One reason why I enjoy night markets is that the food is cheap and filling",
    chunks: [["One","reason","why"],["I","enjoy"],["night","markets"],["is","that"],["the","food","is"],["cheap","and","filling"]] },
  { sentence: "I moved to Taoyuan because the rent in Taipei was too high",
    chunks: [["I","moved","to"],["Taoyuan"],["because"],["the","rent"],["in","Taipei"],["was","too","high"]] },
];
let currentChunkEx = 0;
let selectedWords = [];

function renderChunkExercise(idx) {
  const ex = chunkExercises[idx];
  const words = ex.sentence.split(' ');
  const container = document.getElementById('chunk-exercise-1');
  const answerArea = document.getElementById('chunk-answer-1');
  container.innerHTML = '';
  answerArea.innerHTML = '';
  selectedWords = [];
  document.getElementById('chunk-feedback-1').className = 'feedback';
  document.getElementById('chunk-feedback-1').textContent = '';

  words.forEach((w, i) => {
    const pill = document.createElement('span');
    pill.className = 'chunk-pill';
    pill.textContent = w;
    pill.onclick = () => {
      if(pill.classList.contains('selected')) {
        pill.classList.remove('selected');
        selectedWords = selectedWords.filter(x => x !== i);
      } else {
        pill.classList.add('selected');
        selectedWords.push(i);
      }
      updateAnswerSlots(words);
    };
    container.appendChild(pill);
  });
}

function updateAnswerSlots(words) {
  const area = document.getElementById('chunk-answer-1');
  if(selectedWords.length === 0) { area.innerHTML = '<span style="color:var(--text-dim);font-size:13px;">é»é¸ä¸Šæ–¹çš„å­—çµ„æˆèªå¡Š</span>'; return; }
  const sorted = [...selectedWords].sort((a,b)=>a-b);
  const group = sorted.map(i => words[i]).join(' ');
  area.innerHTML = `<span class="answer-slot">${group}</span>`;
}

function checkChunks(n) {
  const ex = chunkExercises[currentChunkEx];
  const fb = document.getElementById('chunk-feedback-1');
  const sorted = [...selectedWords].sort((a,b)=>a-b);
  const words = ex.sentence.split(' ');
  const userGroup = sorted.map(i => words[i]).join(' ');

  let found = false;
  for(const chunk of ex.chunks) {
    if(chunk.join(' ') === userGroup) { found = true; break; }
  }

  if(found) {
    fb.className = 'feedback success show';
    fb.textContent = 'âœ… æ­£ç¢ºï¼ã€Œ' + userGroup + 'ã€æ˜¯ä¸€å€‹èªå¡Šã€‚è©¦è©¦æ‰¾å‡ºå…¶ä»–èªå¡Šå§ï¼';
  } else {
    fb.className = 'feedback info show';
    const allChunks = ex.chunks.map(c => 'ã€Œ' + c.join(' ') + 'ã€').join('ã€');
    fb.textContent = 'ğŸ’¡ é€™å€‹çµ„åˆä¸å¤ªåƒå¸¸è¦‹èªå¡Šã€‚é€™å¥çš„èªå¡Šåƒè€ƒï¼š' + allChunks;
  }
}

function resetChunks(n) {
  renderChunkExercise(currentChunkEx);
}

function nextChunkExercise() {
  currentChunkEx = (currentChunkEx + 1) % chunkExercises.length;
  renderChunkExercise(currentChunkEx);
}

// ===== COLLOCATION =====
const collocations = [
  { q: '___ the eggï¼ˆæŠŠè›‹æ”ªå‹»ï¼‰', options: ['Beat','Hit','Break','Crack'], answer: 0 },
  { q: '___ the trafficï¼ˆé¿é–‹è»Šæ½®ï¼‰', options: ['Avoid','Beat','Run','Pass'], answer: 1 },
  { q: '___ a comebackï¼ˆé€†è½‰å‹ï¼‰', options: ['Do','Take','Make','Get'], answer: 2 },
  { q: '___ a breakï¼ˆä¼‘æ¯ä¸€ä¸‹ï¼‰', options: ['Have','Make','Take','Do'], answer: 2 },
  { q: '___ some restï¼ˆä¼‘æ¯ä¸€ä¸‹ï¼‰', options: ['Take','Have','Get','Do'], answer: 1 },
  { q: '___ a quick biteï¼ˆå¿«é€Ÿåƒé»æ±è¥¿ï¼‰', options: ['Take','Have','Grab','Get'], answer: 2 },
  { q: '___ the systemï¼ˆé‘½ç³»çµ±æ¼æ´ï¼‰', options: ['Crack','Beat','Break','Hack'], answer: 1 },
  { q: '___ a tripï¼ˆå»æ—…è¡Œï¼‰', options: ['Make','Do','Have','Take'], answer: 3 },
];
let currentColl = 0;

function renderCollocation() {
  const c = collocations[currentColl];
  document.getElementById('collocation-q').textContent = c.q;
  const container = document.getElementById('collocation-options');
  container.innerHTML = '';
  document.getElementById('collocation-feedback').className = 'feedback';
  c.options.forEach((opt, i) => {
    const pill = document.createElement('span');
    pill.className = 'chunk-pill';
    pill.textContent = opt;
    pill.onclick = () => {
      container.querySelectorAll('.chunk-pill').forEach(p => p.classList.remove('selected','correct','wrong'));
      if(i === c.answer) {
        pill.classList.add('correct');
        const fb = document.getElementById('collocation-feedback');
        fb.className = 'feedback success show';
        fb.textContent = 'âœ… æ­£ç¢ºï¼' + opt + ' ' + c.q.replace('___','').trim();
      } else {
        pill.classList.add('wrong');
        const fb = document.getElementById('collocation-feedback');
        fb.className = 'feedback error show';
        fb.textContent = 'âŒ ä¸å¤ªå°ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ' + c.options[c.answer];
      }
    };
    container.appendChild(pill);
  });
}

function nextCollocation() {
  currentColl = (currentColl + 1) % collocations.length;
  renderCollocation();
}

// ===== SAUSAGE =====
function checkSausage() {
  const val = document.getElementById('sausage-input').value.trim();
  const fb = document.getElementById('sausage-feedback');
  if(!val) { fb.className='feedback error show'; fb.textContent='è«‹è¼¸å…¥å¥å­'; return; }
  if(val.toLowerCase().includes("i'm a big fan of") || val.toLowerCase().includes("im a big fan of") || val.toLowerCase().includes("i am a big fan of")) {
    fb.className='feedback success show';
    fb.textContent='âœ… å¾ˆæ£’ï¼ä½ æˆåŠŸç”¨æ¡†æ¶é€ å‡ºäº†å¥å­ã€‚è©¦è©¦å…¶ä»–æ¡†æ¶å§ï¼';
  } else {
    fb.className='feedback info show';
    fb.textContent='ğŸ’¡ è¨˜å¾—ç”¨ã€ŒI\'m a big fan of + åè©ã€é€™å€‹æ¡†æ¶å–”ï¼';
  }
}

// ===== SCENARIOS =====
const scenarios = {
  nightmarket: {
    title: 'ğŸ® é€›å¤œå¸‚', chunks: [
      { en: 'food stalls', zh: 'å°åƒæ”¤', ex: 'There are dozens of food stalls in the night market.' },
      { en: 'grab a quick bite', zh: 'å¿«é€Ÿåƒé»æ±è¥¿', ex: "Let's grab a quick bite before the movie." },
      { en: 'packed with people', zh: 'æ“ æ»¿äº†äºº', ex: 'The night market is packed with people on weekends.' },
      { en: 'lively atmosphere', zh: 'ç†±é¬§çš„æ°£æ°›', ex: 'I love the lively atmosphere of night markets.' },
      { en: 'eat as you walk', zh: 'é‚Šèµ°é‚Šåƒ', ex: 'You can eat as you walk through the market.' },
      { en: 'try a little bit of everything', zh: 'æ¯ç¨®éƒ½è©¦è©¦', ex: 'We can try a little bit of everything tonight.' },
    ]},
  tennis: {
    title: 'ğŸ¾ çœ‹ç¶²çƒ', chunks: [
      { en: 'make a comeback', zh: 'é€†è½‰å‹', ex: 'She made an incredible comeback in the third set.' },
      { en: 'score a service break', zh: 'ç ´ç™¼', ex: 'He scored a service break early in the match.' },
      { en: 'an intense game', zh: 'ä¸€å ´æ¿€çƒˆçš„æ¯”è³½', ex: "It was an intense game that went to five sets." },
      { en: 'have a tough draw', zh: 'ç±¤é‹ä¸å¥½', ex: 'She had a tough draw and faced the top seed in round two.' },
    ]},
  commute: {
    title: 'ğŸš‡ é€šå‹¤æ—¥å¸¸', chunks: [
      { en: 'beat the traffic', zh: 'é¿é–‹è»Šæ½®', ex: 'I left early to beat the traffic.' },
      { en: 'a longer commute', zh: 'æ›´é•·çš„é€šå‹¤', ex: 'Moving there means adjusting to a longer commute.' },
      { en: 'rush hour', zh: 'å°–å³°æ™‚æ®µ', ex: "Rush hour traffic in Taipei is no joke." },
      { en: 'leave early', zh: 'ææ—©é›¢é–‹', ex: "I'll leave early to beat the traffic." },
    ]},
  work: {
    title: 'ğŸ’¼ åŠ ç­å·¥ä½œ', chunks: [
      { en: 'work late', zh: 'åŠ ç­', ex: "I'll probably be working late tonight." },
      { en: 'wrap up', zh: 'çµæŸã€æ”¶å°¾', ex: 'There are a few things I need to wrap up.' },
      { en: 'got no choice but to', zh: 'ä¸å¾—ä¸', ex: "I've got no choice but to stay late." },
      { en: 'tight deadline', zh: 'ç·Šè¿«çš„æˆªæ­¢æ—¥', ex: "We're working against a tight deadline." },
      { en: 'a few things to finish', zh: 'é‚„æœ‰å¹¾ä»¶äº‹è¦å®Œæˆ', ex: 'I have a few things to finish before I leave.' },
    ]},
  coffee: {
    title: 'â˜• å’–å•¡æ–‡åŒ–', chunks: [
      { en: 'pour-over coffee', zh: 'æ‰‹æ²–å’–å•¡', ex: "I prefer pour-over coffee to espresso." },
      { en: 'single origin', zh: 'å–®å“å’–å•¡', ex: 'This is a single origin from Ethiopia.' },
      { en: 'light roast', zh: 'æ·ºç„™', ex: 'Light roast brings out the fruity notes.' },
      { en: 'flavor notes', zh: 'é¢¨å‘³æè¿°', ex: 'The flavor notes include chocolate and citrus.' },
    ]},
  travel: {
    title: 'âœˆï¸ æ—…è¡Œé«”é©—', chunks: [
      { en: 'check in', zh: 'è¾¦ç†ç™»æ©Ÿ/å…¥ä½', ex: 'We need to check in at least two hours early.' },
      { en: 'go through customs', zh: 'éæµ·é—œ', ex: 'Going through customs took forever.' },
      { en: 'jet lag', zh: 'æ™‚å·®', ex: 'I always get terrible jet lag flying to Europe.' },
      { en: 'travel light', zh: 'è¼•è£æ—…è¡Œ', ex: 'I prefer to travel light with just a backpack.' },
    ]},
};

function loadScenario(key) {
  const s = scenarios[key];
  let html = `<div class="exercise-box"><div class="exercise-label">${s.title} â€” æ ¸å¿ƒèªå¡Š</div>`;
  s.chunks.forEach(c => {
    html += `<div style="padding:10px 0;border-bottom:1px solid var(--border);display:flex;align-items:baseline;gap:12px;">
      <div style="min-width:180px;"><span class="chunk chunk-verb">${c.en}</span> <span style="color:var(--text-dim);font-size:12px;">${c.zh}</span></div>
      <div style="font-size:14px;color:var(--text-dim);cursor:pointer;" onclick="speak('${c.ex.replace(/'/g,"\\'")}')">ğŸ”Š ${c.ex}</div>
    </div>`;
  });
  html += `<button class="btn btn-primary btn-sm" style="margin-top:12px;" onclick="speak('${s.chunks.map(c=>c.ex).join('. ').replace(/'/g,"\\'")}', 0.85)">ğŸ”Š å…¨éƒ¨æ’­æ”¾</button></div>`;
  document.getElementById('scenario-detail').innerHTML = html;
}

// ===== RESPEAK =====
const respeakSentences = [
  { en: "I've been to Tokyo many times.", zh: 'æˆ‘å»éæ±äº¬å¾ˆå¤šæ¬¡ã€‚', chunks: ["I've","been to","Tokyo","many times"] },
  { en: "I've never seen that.", zh: 'æˆ‘å¾ä¾†æ²’æœ‰çœ‹éé‚£å€‹ã€‚', chunks: ["I've","never","seen that"] },
  { en: "I've never been there.", zh: 'æˆ‘å¾ä¾†æ²’æœ‰å»éé‚£è£¡ã€‚', chunks: ["I've","never","been there"] },
  { en: "I've finished.", zh: 'æˆ‘å®Œæˆäº†ã€‚', chunks: ["I've","finished"] },
  { en: "I've sent an email.", zh: 'æˆ‘å¯„äº†ä¸€å°ä¿¡ã€‚', chunks: ["I've","sent","an email"] },
  { en: "It's been a long day.", zh: 'ä»Šå¤©å¥½æ¼«é•·ã€‚', chunks: ["It's been","a long day"] },
  { en: "Have you arrived?", zh: 'ä½ åˆ°äº†å—ï¼Ÿ', chunks: ["Have you","arrived"] },
];
let respeakIdx = 0;

function renderRespeak() {
  const s = respeakSentences[respeakIdx];
  const container = document.getElementById('respeak-container');
  container.innerHTML = `
    <div class="respeak-sentence">${s.en}</div>
    <div class="respeak-translation">${s.zh}</div>
    <div class="respeak-chunks">${s.chunks.map(c => `<span class="respeak-chunk">${c}</span>`).join('')}</div>
    <button class="play-btn" onclick="speak('${s.en.replace(/'/g,"\\'")}', 0.85)">ğŸ”Š</button>
  `;
  document.getElementById('respeak-progress').style.width = ((respeakIdx+1)/respeakSentences.length*100)+'%';
}
function speakCurrent() { speak(respeakSentences[respeakIdx].en, 0.85); }
function nextRespeak() { respeakIdx = (respeakIdx+1) % respeakSentences.length; renderRespeak(); }
function prevRespeak() { respeakIdx = (respeakIdx-1+respeakSentences.length) % respeakSentences.length; renderRespeak(); }

// Daily respeak
const dailySentences = [
  { en: "I try to focus on one task at a time.", zh: 'æˆ‘å˜—è©¦ä¸€æ¬¡å°ˆæ³¨ä¸€ä»¶äº‹ã€‚', chunks: ["I try to","focus on","one task","at a time"] },
  { en: "When the deadline gets closer, I feel more pressure.", zh: 'æˆªæ­¢æ—¥å¿«åˆ°æ™‚ï¼Œæˆ‘æœƒæ„Ÿåˆ°æ›´å¤šå£“åŠ›ã€‚', chunks: ["When","the deadline","gets closer","I feel","more pressure"] },
  { en: "I moved to Taoyuan because the rent was too high.", zh: 'å› ç‚ºæˆ¿ç§Ÿå¤ªé«˜æˆ‘æ¬å»æ¡ƒåœ’äº†ã€‚', chunks: ["I moved to","Taoyuan","because","the rent","was too high"] },
  { en: "I'm really into tennis these days.", zh: 'æˆ‘æœ€è¿‘å¾ˆè¿·ç¶²çƒã€‚', chunks: ["I'm","really into","tennis","these days"] },
  { en: "The night market is packed with people.", zh: 'å¤œå¸‚è£¡æ“ æ»¿äº†äººã€‚', chunks: ["The night market","is packed","with people"] },
];
let dailyIdx = 0;

function renderRespeakDaily() {
  const s = dailySentences[dailyIdx];
  document.getElementById('respeak-daily-container').innerHTML = `
    <div class="respeak-sentence">${s.en}</div>
    <div class="respeak-translation">${s.zh}</div>
    <div class="respeak-chunks">${s.chunks.map(c => `<span class="respeak-chunk">${c}</span>`).join('')}</div>
    <button class="play-btn" onclick="speak('${s.en.replace(/'/g,"\\'")}', 0.85)">ğŸ”Š</button>
  `;
}
function speakCurrentDaily() { speak(dailySentences[dailyIdx].en, 0.85); }
function nextRespeakDaily() { dailyIdx = (dailyIdx+1) % dailySentences.length; renderRespeakDaily(); }
function prevRespeakDaily() { dailyIdx = (dailyIdx-1+dailySentences.length) % dailySentences.length; renderRespeakDaily(); }

// Scenario respeak
const respeakScenarios = {
  ordering: [
    "Can I get the fried chicken, please?",
    "I'll have the beef noodle soup.",
    "Could I get that to go?",
    "Just water is fine, thanks.",
    "Do you have anything vegetarian?",
  ],
  shopping: [
    "How much is this one?",
    "Do you have this in a different color?",
    "Can you give me a better price?",
    "I'm just looking, thanks.",
    "I'll take two of these.",
  ],
  meeting: [
    "Let's get started, shall we?",
    "I'd like to go over a few things today.",
    "Does anyone have any questions so far?",
    "Let's move on to the next point.",
    "I think we can wrap up here.",
  ],
  smalltalk: [
    "How was your weekend?",
    "Have you tried that new restaurant?",
    "I've been meaning to ask you about that.",
    "That sounds like a lot of fun.",
    "I know what you mean.",
  ],
};

function loadRespeakScenario(key) {
  const sentences = respeakScenarios[key];
  let html = '<div class="exercise-box"><div class="exercise-label">é€å¥ Respeak</div>';
  sentences.forEach((s,i) => {
    html += `<div style="padding:10px 0;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;">
      <button class="btn btn-secondary btn-sm" onclick="speak('${s.replace(/'/g,"\\'")}',0.8)" style="flex-shrink:0;">ğŸ”Š</button>
      <span style="font-size:15px;">${s}</span>
    </div>`;
  });
  html += `<button class="btn btn-primary btn-sm" style="margin-top:12px;" onclick="speak('${sentences.join('. ').replace(/'/g,"\\'")}',0.8)">ğŸ”Š é€£çºŒæ’­æ”¾</button></div>`;
  document.getElementById('respeak-scenario-detail').innerHTML = html;
}

// ===== EXPANSION =====
const expansionExercises = [
  { base: "I moved to Taoyuan.", connectors: [
    { word: "because", example: "I moved to Taoyuan because the rent in Taipei was too high." },
    { word: "even though", example: "I moved to Taoyuan even though it's farther from my office." },
    { word: "in order to", example: "I moved to Taoyuan in order to save money." },
    { word: "and", example: "I moved to Taoyuan and I feel less stressed now." },
    { word: "where", example: "I moved to Taoyuan where the pace of life is slower." },
    { word: "so", example: "I moved to Taoyuan so my living costs are lower now." },
  ]},
  { base: "I like night markets.", connectors: [
    { word: "because", example: "I like night markets because the food is cheap and filling." },
    { word: "especially", example: "I like night markets, especially the ones in Tainan." },
    { word: "even though", example: "I like night markets even though they're always crowded." },
    { word: "where", example: "I like night markets where you can find local snacks." },
  ]},
  { base: "I started learning English.", connectors: [
    { word: "when", example: "I started learning English when I was in elementary school." },
    { word: "because", example: "I started learning English because I wanted to travel abroad." },
    { word: "and", example: "I started learning English and it changed my life." },
    { word: "even though", example: "I started learning English even though I was afraid of making mistakes." },
  ]},
];

function renderExpansion() {
  const container = document.getElementById('expansion-exercises');
  let html = '';
  expansionExercises.forEach((ex, i) => {
    html += `<div class="exercise-box" style="margin-bottom:16px;">
      <div class="expansion-base">${ex.base}</div>
      <div class="exercise-label">ç”¨é€£æ¥è©æ“´å¥</div>
      <ul class="expansion-list">`;
    ex.connectors.forEach(c => {
      html += `<li>
        <span class="expansion-connector">${c.word}</span>
        <span class="expansion-sentence">${c.example}</span>
        <button class="btn btn-secondary btn-sm" style="flex-shrink:0;margin-left:auto;" onclick="speak('${c.example.replace(/'/g,"\\'")}',0.85)">ğŸ”Š</button>
      </li>`;
    });
    html += `</ul>
      <div style="margin-top:12px;font-size:13px;color:var(--text-dim);">âœï¸ ä½ çš„å›åˆï¼š</div>
      <input class="expansion-input" placeholder="ç”¨ä»»ä½•é€£æ¥è©æ“´å……ã€Œ${ex.base}ã€" />
    </div>`;
  });
  container.innerHTML = html;
}

// ===== ESPRESSO =====
let espressoInterval = null;
let espressoRunning = false;
let espressoRound = 1;
let espressoTime = 60;
const roundTimes = [60, 50, 40];

function startEspresso(topic, topicEn) {
  document.getElementById('espresso-active').style.display = 'block';
  document.getElementById('espresso-topic').textContent = topic;
  espressoRound = 1; espressoTime = 60; espressoRunning = false;
  if(espressoInterval) clearInterval(espressoInterval);
  updateEspressoUI();
  document.getElementById('espresso-active').scrollIntoView({behavior:'smooth'});
}

function toggleEspresso() {
  if(espressoRunning) {
    clearInterval(espressoInterval);
    espressoRunning = false;
    document.getElementById('espresso-start-btn').textContent = 'â–¶ ç¹¼çºŒ';
  } else {
    espressoRunning = true;
    document.getElementById('espresso-start-btn').textContent = 'â¸ æš«åœ';
    espressoInterval = setInterval(() => {
      espressoTime--;
      if(espressoTime <= 0) {
        clearInterval(espressoInterval);
        espressoRunning = false;
        if(espressoRound < 3) {
          espressoRound++;
          espressoTime = roundTimes[espressoRound-1];
          document.getElementById('espresso-start-btn').textContent = 'â–¶ é–‹å§‹ç¬¬ ' + espressoRound + ' è¼ª';
        } else {
          document.getElementById('espresso-start-btn').textContent = 'ğŸ‰ å®Œæˆï¼';
        }
      }
      updateEspressoUI();
    }, 1000);
  }
}

function resetEspresso() {
  if(espressoInterval) clearInterval(espressoInterval);
  espressoRound = 1; espressoTime = 60; espressoRunning = false;
  document.getElementById('espresso-start-btn').textContent = 'â–¶ é–‹å§‹';
  updateEspressoUI();
}

function updateEspressoUI() {
  document.getElementById('espresso-round').textContent = `ç¬¬ ${espressoRound} è¼ª / 3 â€” ${roundTimes[espressoRound-1]} ç§’`;
  document.getElementById('espresso-time').textContent = espressoTime;
  const color = espressoTime <= 10 ? 'var(--error)' : espressoTime <= 20 ? 'var(--accent2)' : 'var(--accent)';
  document.getElementById('espresso-time').style.color = color;
}

// ===== UPGRADE =====
const upgradePairs = [
  { b1: "Night markets are very crowded.", c1: "Night markets can get quite crowded, especially on weekends.", note: "C1 ç”¨ can get è¡¨é”ã€Œæœ‰æ™‚å€™æœƒã€ï¼ŒåŠ ä¸Š especially é™å®šæ¢ä»¶ï¼Œæ›´ç²¾æº–ã€‚" },
  { b1: "This decision is really risky.", c1: "This decision could be risky depending on how it's implemented.", note: "C1 ç”¨ could be è¡¨é”å¯èƒ½æ€§ï¼Œdepending on å¢åŠ æ¢ä»¶åˆ¤æ–·ã€‚" },
  { b1: "I have to work late today.", c1: "I'll probably be working late tonight because there are a few things I need to wrap up.", note: "C1 ç”¨ probably be working è¡¨é”å…«æˆç¢ºå®šçš„èªæ°£ï¼Œwrap up æ˜¯å¸¸ç”¨èªå¡Šã€‚" },
  { b1: "I moved to Taoyuan because rent in Taipei was too high.", c1: "I moved to Taoyuan largely for financial reasons, though it did mean adjusting to a longer commute.", note: "C1 ç”¨ largely for financial reasons æ›´æ¦‚æ‹¬ï¼Œthough it did mean å¸¶å‡ºè½‰æŠ˜ã€‚" },
  { b1: "I decided to move.", c1: "I ended up moving.", note: "ended up å¸¶æœ‰ã€Œæœ€å¾Œé‚„æ˜¯ã€çš„ç„¡å¥ˆèªæ°£ï¼Œæ¯” decided æ›´è‡ªç„¶ã€‚" },
  { b1: "I must work late today.", c1: "I've got no choice but to stay late tonight.", note: "got no choice but to è¡¨é”ã€Œä¸å¾—ä¸ã€ï¼Œæ¯” must æ›´å£èªæ›´ç²¾æº–ã€‚" },
];

function renderUpgradePairs() {
  let html = '';
  upgradePairs.forEach((p,i) => {
    html += `<div class="exercise-box" style="margin-bottom:12px;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <div style="font-size:11px;font-weight:700;color:var(--b1);margin-bottom:6px;">B1 èªªæ³•</div>
          <div style="font-size:15px;cursor:pointer;" onclick="speak('${p.b1.replace(/'/g,"\\'")}',0.85)">${p.b1} ğŸ”Š</div>
        </div>
        <div>
          <div style="font-size:11px;font-weight:700;color:var(--c1);margin-bottom:6px;">C1 è‡ªç„¶è¡¨é”</div>
          <div style="font-size:15px;cursor:pointer;" onclick="speak('${p.c1.replace(/'/g,"\\'")}',0.85)">${p.c1} ğŸ”Š</div>
        </div>
      </div>
      <div style="margin-top:10px;font-size:13px;color:var(--text-dim);border-top:1px solid var(--border);padding-top:10px;">ğŸ’¡ ${p.note}</div>
    </div>`;
  });
  document.getElementById('upgrade-pairs').innerHTML = html;
}

// Lexical range
const lexicalCards = [
  { concept: 'å¾ˆé‡è¦', basic: 'very important', alternatives: ['a key driver', 'a major factor', 'our top priority', 'it matters a lot', 'crucial', 'essential'] },
  { concept: 'è§£æ±ºå•é¡Œ', basic: 'solve the problem', alternatives: ['address the issue', 'fix the bottleneck', 'tackle the challenge', 'work through it', 'sort it out'] },
  { concept: 'è¨è«–', basic: 'talk about', alternatives: ['touch on', 'dive into', 'walk through', 'go over', 'cover', 'bring up'] },
  { concept: 'å¾ˆå¥½', basic: 'very good', alternatives: ['outstanding', 'exceptional', 'impressive', 'remarkable', 'solid', 'top-notch'] },
];

function renderLexical() {
  let html = '';
  lexicalCards.forEach(c => {
    html += `<div class="exercise-box" style="margin-bottom:12px;">
      <div style="display:flex;align-items:baseline;gap:12px;margin-bottom:10px;">
        <span style="font-size:13px;color:var(--text-dim);">${c.concept}</span>
        <span style="font-size:11px;background:rgba(239,68,68,0.1);color:var(--error);padding:2px 8px;border-radius:4px;">ä¸è¦æ°¸é ç”¨</span>
        <span style="font-weight:700;">${c.basic}</span>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:6px;">
        ${c.alternatives.map(a => `<span class="chunk-pill" onclick="speak('${a}',0.85)" style="cursor:pointer;">${a}</span>`).join('')}
      </div>
    </div>`;
  });
  document.getElementById('lexical-cards').innerHTML = html;
}

// ===== DICTATION =====
const dictationSentences = [
  { text: "And what we tried to do, I think more than anything else, is recognize that you can't exceed the expectations of your customers unless you exceed the expectations of your people.", source: "Howard Schultz, Starbucks CEO" },
  { text: "I'll probably be working late tonight because there are a few things I need to wrap up before the deadline.", source: "Workplace conversation" },
  { text: "One reason why I enjoy night markets is that the food is cheap and filling, so I can try many things without spending much.", source: "Daily conversation" },
  { text: "I moved to Taoyuan largely for financial reasons, though it did mean adjusting to a longer commute.", source: "Daily conversation" },
];
let dictIdx = 0;

function playDictation() {
  speak(dictationSentences[dictIdx].text, 0.8);
  document.getElementById('dictation-prompt').textContent = 'ğŸ§ æ­£åœ¨æ’­æ”¾... è½å®Œå¾Œåœ¨ä¸‹æ–¹å¯«å‡ºä½ è½åˆ°çš„å¥å­ã€‚ (' + dictationSentences[dictIdx].source + ')';
}

function checkDictation() {
  const fb = document.getElementById('dictation-feedback');
  fb.className = 'feedback info show';
  fb.innerHTML = `<strong>åŸæ–‡ï¼š</strong><br>${dictationSentences[dictIdx].text}<br><br><em>ä¾†æºï¼š${dictationSentences[dictIdx].source}</em><br><br>ğŸ’¡ å°ç…§ä½ å¯«çš„å…§å®¹ï¼Œæ³¨æ„èªå¡Šé‚Šç•Œå’Œæ–·å¥ä½ç½®ã€‚`;
}

function nextDictation() {
  dictIdx = (dictIdx + 1) % dictationSentences.length;
  document.getElementById('dictation-input').value = '';
  document.getElementById('dictation-feedback').className = 'feedback';
  document.getElementById('dictation-prompt').textContent = 'é»æ“Šæ’­æ”¾ï¼Œè½å®Œå¾Œåœ¨ä¸‹æ–¹å¯«å‡ºä½ è½åˆ°çš„å¥å­ã€‚';
}

// ===== INIT =====
renderChunkExercise(0);
renderCollocation();
renderRespeak();
renderRespeakDaily();
renderExpansion();
renderUpgradePairs();
renderLexical();
</script>
</body>
</html>
